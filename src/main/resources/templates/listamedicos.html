<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Listar Médicos ou Pacientes</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <header class="header">
        <div class="header-content">
            <h1>Listar Médicos ou Pacientes</h1>
        </div>
    </header>
    <a href="/" class="back-button">
        <i class="fas fa-arrow-left"></i>
    </a>
    <div class="content">
        <button id="listar" class="button">
            <i class="fas fa-sync-alt"></i>
        </button>

        <div id="list" class="json-response"></div>

        <div id="pagination" class="pagination">
            <button id="prevPage" class="button" disabled>Anterior</button>
            <button id="nextPage" class="button" disabled>Próxima</button>
        </div>
    </div>

    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeModal">&times;</span>
            <p id="confirmMessage">Tem certeza que deseja excluir este item?</p>
            <button id="confirmDelete" class="button confirm-button">Confirmar</button>
            <button id="cancelDelete" class="button cancel-button">Cancelar</button>
        </div>
    </div>

    <div id="notification" class="alert"></div>
    <footer class="footer">
        <p>&copy; 2025 Gestão de Médicos ou Pacientes. Todos os direitos reservados.</p>
    </footer>
    <script>
        let currentPage = 0;
        let itemIdToDelete = null;

        // Função para pegar o parâmetro da URL (origem=pacientes ou origem=medicos)
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        const origem = getUrlParameter('origem') === 'pacientes' ? 'paciente' : 'medico';

        // Função para carregar os dados de médicos ou pacientes
        function fetchData(page) {
            const url = `http://localhost:8080/${origem}/buscar?page=${page}&size=3`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const list = document.getElementById('list');
                    list.innerHTML = '';  // Limpa a lista antes de popular os itens

                    data.content.forEach(item => {
                        const itemBox = document.createElement('div');
                        itemBox.classList.add('item-box');
                        itemBox.innerHTML = `
                            <div class="item-data">
                                <p><strong>Nome:</strong> ${item.nome}</p>
                                <p><strong>Email:</strong> ${item.email}</p>
                                ${item.crm ? `<p><strong>CRM:</strong> ${item.crm}</p>` : ''}
                                ${item.especialidade ? `<p><strong>Especialidade:</strong> ${item.especialidade}</p>` : ''}
                            </div>
                        `;
                        list.appendChild(itemBox);
                    });

                    updatePagination(data);
                })
                .catch(error => console.error(`Erro ao buscar ${origem}s:`, error));
        }

        // Função para atualizar a paginação
        function updatePagination(data) {
            document.getElementById('prevPage').disabled = currentPage === 0;
            document.getElementById('nextPage').disabled = currentPage === data.totalPages - 1;
        }

        // Função para fechar o modal
        function closeModal() {
            document.getElementById('confirmModal').style.display = 'none';
        }

        // Função para exibir a notificação
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `alert alert-${type}`;
            notification.classList.add('show');
            setTimeout(() => notification.classList.remove('show'), 3000);
        }

        // Evento para confirmar a exclusão
        document.getElementById('confirmDelete').addEventListener('click', () => {
            fetch(`http://localhost:8080/${origem}/Delete/${itemIdToDelete}`, { method: 'DELETE' })
                .then(response => {
                    if (response.ok) {
                        showNotification(`${origem === 'paciente' ? 'Paciente' : 'Médico'} deletado com sucesso!`, 'success');
                        fetchData(currentPage);
                        closeModal();
                    } else {
                        showNotification(`Erro ao deletar o ${origem === 'paciente' ? 'paciente' : 'médico'}.`, 'error');
                    }
                })
                .catch(error => console.error(`Erro ao tentar deletar o ${origem === 'paciente' ? 'paciente' : 'médico'}:`, error));
        });

        // Evento para fechar o modal
        document.getElementById('closeModal').addEventListener('click', closeModal);
        document.getElementById('cancelDelete').addEventListener('click', closeModal);

        // Evento para listar os médicos ou pacientes
        document.getElementById('listar').addEventListener('click', () => fetchData(currentPage));

        // Evento para navegar pelas páginas
        document.getElementById('prevPage').addEventListener('click', () => {
            if (currentPage > 0) {
                currentPage--;
                fetchData(currentPage);
            }
        });

        document.getElementById('nextPage').addEventListener('click', () => {
            currentPage++;
            fetchData(currentPage);
        });

        // Carregar os dados da página inicial
        fetchData(currentPage);
    </script>
</body>

</html>
