<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atualizar Médico</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px;
            background-color: #4CAF50;
            color: white;
            border-radius: 5px;
            display: none;
            z-index: 1000;
            font-size: 16px;
        }

        .error {
            background-color: #f44336;
        }
    </style>
</head>

<body>
    <header class="header">
        <div class="header-content">
            <h1>Atualizar Médico</h1>
            <nav class="navbar">
            </nav>
        </div>
    </header>
    <a href="/listamedicos" class="back-button">
        <i class="fas fa-arrow-left"></i>
    </a>
    <div class="content">

        <form id="updateMedicoForm">
            <input type="hidden" id="id" name="id">
            <div class="form-group">
                <label for="nome">Nome</label>
                <input type="text" id="nome" name="nome" required>
            </div>
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" required>
            </div>
            <div class="form-group">
                <label for="crm">CRM</label>
                <input type="text" id="crm" name="crm" required>
            </div>
            <div class="form-group">
                <label for="especialidade">Especialidade:</label>
                <select id="especialidade" name="especialidade" required>
                    <option value="ORTOPEDIA">ORTOPEDIA</option>
                    <option value="CARDIOLOGIA">CARDIOLOGIA</option>
                    <option value="GINEOCOLOGIA">GINEOCOLOGIA</option>
                    <option value="DERMATOLOGIA">DERMATOLOGIA</option>
                </select>
            </div>
            <div class="form-group">
                <label for="telefone">Telefone</label>
                <input type="text" id="telefone" name="telefone" required>
            </div>
            <button type="submit" class="button">Atualizar</button>
        </form>
    </div>

    <div id="notification" class="notification">
        <span id="notification-message"></span>
    </div>
    <footer class="footer">
        <p>&copy; 2025 Gestão de Médicos. Todos os direitos reservados.</p>
    </footer>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('id');

        window.onload = function () {
            fetch(`http://localhost:8080/medico/buscar/${id}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('id').value = data.id;
                    document.getElementById('nome').value = data.nome;
                    document.getElementById('email').value = data.email;
                    document.getElementById('crm').value = data.crm;
                    document.getElementById('especialidade').value = data.especialidade;
                    document.getElementById('telefone').value = data.telefone;

                })
                .catch(error => {
                    showNotification('Erro ao carregar os dados do médico', true);
                });
        };

        document.getElementById('updateMedicoForm').addEventListener('submit', function (event) {
            event.preventDefault();

            const medicoAtualizado = {
                id: document.getElementById('id').value,
                nome: document.getElementById('nome').value,
                email: document.getElementById('email').value,
                crm: document.getElementById('crm').value,
                especialidade: document.getElementById('especialidade').value,
                telefone: document.getElementById('telefone').value
            };

            fetch(`http://localhost:8080/medico/atualizar`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(medicoAtualizado)
            })
                .then(response => {
                    if (response.ok) {
                        showNotification('Médico atualizado com sucesso!', false);
                    } else {
                        showNotification('Erro ao atualizar médico', true);
                    }
                })
                .catch(error => {
                    showNotification('Erro ao atualizar médico', true);
                });
        });

        function showNotification(message, isError) {
            const notification = document.getElementById('notification');
            const messageSpan = document.getElementById('notification-message');
            messageSpan.textContent = message;
            if (isError) {
                notification.classList.add('error');
            } else {
                notification.classList.remove('error');
            }
            notification.style.display = 'block';


            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
    </script>
</body>

</html>